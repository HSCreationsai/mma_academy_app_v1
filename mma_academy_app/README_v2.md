# Indonesia MMA Youth Excellence Academy & National Coach Training Program - Streamlit App (Coach Olympus Edition)

This application, featuring **Coach Olympus**, serves as an intelligent assistant and training portal for MMA coaches and certified athletes associated with the Indonesia MMA Youth Excellence Academy & National Coach Training Program.

## Features

*   **Invite-Only Login:** Secure email-token based authentication.
*   **Dashboard:** Personalized welcome and (placeholder) progress summary.
*   **Video Center:** Stream admin-curated training videos.
*   **Manual Reader:** Read the comprehensive PDF training manual page by page, with Text-to-Speech (TTS) support.
*   **Coach Olympus (RAG Chatbot):** Interact with an AI coach powered by a local LLM (e.g., DeepSeek 7B) that uses the training manual as its knowledge base. Features improved caching and diagnostic output for performance monitoring.
*   **Community Wall:** Internal discussion forum for members.
*   **Admin Panel:** For administrators to manage video content, upload PDF resources, and manage user invites.

## Key Improvements in this Version

*   **Assistant Renamed:** The chatbot is now introduced as "Coach Olympus".
*   **FAISS Index Persistence:** The FAISS index for the RAG agent is now saved to `data/manual_faiss.index` after its first build and loaded from this file on subsequent runs if `manual.json` hasn't changed. This significantly speeds up initialization after the very first run.
*   **Configurable Embedding Model:** The embedding model used by the RAG agent can now be specified in `secrets.toml` under the `[embedding]` section (e.g., `model_name = "all-MiniLM-L6-v2"`).
*   **Performance Diagnostics:** Added `st.write` messages and timing information within the RAG agent to help diagnose loading times for embedding models, FAISS index, and LLMs, and to show whether the LLM is using CPU or GPU.
*   **Guidance on `ModuleNotFoundError`:** Recommendations provided to run the Streamlit app from the project root directory (e.g., `D:\mma_academy_app> streamlit run mma_academy_app/app.py`) to resolve Python import issues.
*   **Corrected FAISS `top_k` issue:** Removed an erroneous call in the chatbot page that could cause FAISS assertion errors.

## Project Structure

```
mma_academy_app/
├── .streamlit/
│   └── secrets.toml      # Configuration for admin, SMTP, Disqus, LLM path, Embedding model
├── assets/
│   ├── logo.png            # Application logo
│   └── manual_draft.pdf    # The main PDF training manual
│   └── uploads/            # Directory for admin-uploaded PDF resources
│   └── temp_audio/         # Temporary storage for TTS audio files
├── data/
│   ├── manual.json         # JSON version of the manual (generated by pdf_to_json.py)
│   └── manual_faiss.index  # Saved FAISS index for faster RAG initialization
├── pages/
│   ├── 1_Login.py
│   ├── 2_Dashboard.py
│   ├── 3_Video_Center.py
│   ├── 4_Chatbot.py        # Features Coach Olympus
│   ├── 5_Community.py
│   ├── 6_Admin_Panel.py
│   └── 7_Manual_Reader.py
├── utils/
│   ├── auth.py             # Authentication logic
│   ├── db_utils.py         # SQLite database interaction utilities
│   ├── rag_agent.py        # RAG Chatbot logic (Coach Olympus)
│   └── pdf_to_json.py      # Script to convert manual_draft.pdf to manual.json
├── app.py                  # Main Streamlit application entry point
├── requirements.txt        # Python dependencies
├── README.md               # This file
└── mma_academy.db          # SQLite database file (will be created on first run)
```

## Setup and Installation (Windows with PyCharm & Python 3.12.x)

1.  **Prerequisites:**
    *   Python 3.12.x (or a compatible 3.9+ version). Ensure it's added to your system PATH.
    *   PyCharm IDE (Community or Professional).

2.  **Download and Extract:**
    *   Download the `mma_academy_app_v2.zip` file.
    *   Extract its contents to a desired location (e.g., `C:/Projects/`). This creates the `mma_academy_app` folder.

3.  **Open in PyCharm & Create Virtual Environment:** (As per previous instructions)

4.  **Install Dependencies:**
    *   Open the Terminal in PyCharm.
    *   Ensure your virtual environment is activated.
    *   Run: `pip install -r requirements.txt`

5.  **Configure `secrets.toml`:**
    *   Navigate to `.streamlit/secrets.toml`.
    *   Update `[admin] email`.
    *   Configure `[smtp]` details for email sending.
    *   **Crucial:** Set `[llm] model_path` to the **absolute path** of your local LLM model (e.g., `D:/Cache/deepseek-7b`).
    *   (Optional) Configure `[embedding] model_name` if you want to use a different SentenceTransformer model than the default `all-MiniLM-L6-v2`.

6.  **Prepare the Training Manual & FAISS Index:**
    *   Copy your main training manual PDF to `mma_academy_app/assets/` and rename it to `manual_draft.pdf`.
    *   Run the PDF to JSON conversion script from the PyCharm terminal (ensure virtual environment is active and you are in the `mma_academy_app` project root, e.g., `D:\mma_academy_app>`):
        ```bash
        python utils/pdf_to_json.py 
        ```
        (Note: If you are inside the inner `mma_academy_app` folder, the command would be `python ../utils/pdf_to_json.py` or adjust paths in the script if it has issues finding `assets/manual_draft.pdf` from there. Running from the project root `D:\mma_academy_app>` is generally safer for scripts that use relative paths like `../assets/`.)
        This creates `data/manual.json`. The FAISS index (`data/manual_faiss.index`) will be automatically built (and saved) the first time the Chatbot page is loaded.

## Running the Application

1.  **Open the Terminal in PyCharm.**
2.  Ensure your virtual environment is activated.
3.  **Navigate to the project root directory** (e.g., `D:\mma_academy_app>`).
4.  Run the Streamlit application using:
    ```bash
    streamlit run mma_academy_app/app.py
    ```
5.  Access the app in your browser (usually `http://localhost:8501`).

## Performance Notes

*   **Initial Load:** The very first time you load the Chatbot page, it will:
    *   Load the embedding model.
    *   Generate embeddings for the entire manual and build the FAISS index (if `manual_faiss.index` doesn't exist or is older than `manual.json`). This can take time.
    *   Save the FAISS index to `data/manual_faiss.index`.
    *   Load the LLM (e.g., DeepSeek 7B from your D: drive). This can take several minutes.
*   **Subsequent Loads (Chatbot Page):**
    *   It should load the FAISS index from `data/manual_faiss.index` (much faster than rebuilding).
    *   The embedding model and LLM should be retrieved from Streamlit's cache, avoiding full reloads.
*   **Query Performance:** If queries are still very slow after the initial setup:
    *   Check the diagnostic messages in the Streamlit UI: Is the LLM using CPU or GPU? How long is the actual "LLM inference" step taking?
    *   A 7B model on CPU for inference will be significantly slower than on a compatible GPU. Ensure your PyTorch installation can see and use your GPU if you have one.
    *   Ensure your system has enough RAM for the LLM.

This updated version aims to provide a more robust and performant experience with Coach Olympus.

